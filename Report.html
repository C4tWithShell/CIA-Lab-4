<!DOCTYPE html>

<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="mobile-web-app-capable" content="yes">
    <title>
        CIA Lab 4 - DNSSec and DoH - HackMD
    </title>
    <link rel="icon" type="image/png" href="https://hackmd.io/favicon.png">
    <link rel="apple-touch-icon" href="https://hackmd.io/apple-touch-icon.png">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/ionicons/2.0.1/css/ionicons.min.css" integrity="sha256-3iu9jgsy9TpTwXKb7bNQzqWekRX7pPK+2OLj3R922fo=" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/octicons/3.5.0/octicons.min.css" integrity="sha256-QiWfLIsCT02Sdwkogf6YMiQlj4NE84MKkzEMkZnMGdg=" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.5.1/themes/prism.min.css" integrity="sha256-vtR0hSWRc3Tb26iuN2oZHt3KRUomwTufNIf5/4oeCyg=" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@hackmd/emojify.js@2.1.0/dist/css/basic/emojify.min.css" integrity="sha256-UOrvMOsSDSrW6szVLe8ZDZezBxh5IoIfgTwdNDgTjiU=" crossorigin="anonymous" />
    <style>
        @import url(https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,500,500i|Source+Code+Pro:300,400,500|Source+Sans+Pro:300,300i,400,400i,600,600i|Source+Serif+Pro&subset=latin-ext);.hljs{display:block;background:#fff;padding:.5em;color:#333;overflow-x:auto}.hljs-comment,.hljs-meta{color:#969896}.hljs-emphasis,.hljs-quote,.hljs-string,.hljs-strong,.hljs-template-variable,.hljs-variable{color:#df5000}.hljs-keyword,.hljs-selector-tag,.hljs-type{color:#a71d5d}.hljs-attribute,.hljs-bullet,.hljs-literal,.hljs-number,.hljs-symbol{color:#0086b3}.hljs-built_in,.hljs-builtin-name{color:#005cc5}.hljs-name,.hljs-section{color:#63a35c}.hljs-tag{color:#333}.hljs-attr,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-id,.hljs-selector-pseudo,.hljs-title{color:#795da3}.hljs-addition{color:#55a532;background-color:#eaffea}.hljs-deletion{color:#bd2c00;background-color:#ffecec}.hljs-link{text-decoration:underline}.markdown-body{font-size:16px;line-height:1.5;word-wrap:break-word}.markdown-body:after,.markdown-body:before{display:table;content:""}.markdown-body:after{clear:both}.markdown-body>:first-child{margin-top:0!important}.markdown-body>:last-child{margin-bottom:0!important}.markdown-body a:not([href]){color:inherit;text-decoration:none}.markdown-body .absent{color:#c00}.markdown-body .anchor{float:left;padding-right:4px;margin-left:-20px;line-height:1}.markdown-body .anchor:focus{outline:none}.markdown-body blockquote,.markdown-body dl,.markdown-body ol,.markdown-body p,.markdown-body pre,.markdown-body table,.markdown-body ul{margin-top:0;margin-bottom:16px}.markdown-body hr{height:.25em;padding:0;margin:24px 0;background-color:#e7e7e7;border:0}.markdown-body blockquote{font-size:16px;padding:0 1em;color:#777;border-left:.25em solid #ddd}.markdown-body blockquote>:first-child{margin-top:0}.markdown-body blockquote>:last-child{margin-bottom:0}.markdown-body kbd,.popover kbd{display:inline-block;padding:3px 5px;font-size:11px;line-height:10px;color:#555;vertical-align:middle;background-color:#fcfcfc;border:1px solid #ccc;border-bottom-color:#bbb;border-radius:3px;box-shadow:inset 0 -1px 0 #bbb}.markdown-body .loweralpha{list-style-type:lower-alpha}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin-top:24px;margin-bottom:16px;font-weight:600;line-height:1.25}.markdown-body h1 .octicon-link,.markdown-body h2 .octicon-link,.markdown-body h3 .octicon-link,.markdown-body h4 .octicon-link,.markdown-body h5 .octicon-link,.markdown-body h6 .octicon-link{color:#000;vertical-align:middle;visibility:hidden}.markdown-body h1:hover .anchor,.markdown-body h2:hover .anchor,.markdown-body h3:hover .anchor,.markdown-body h4:hover .anchor,.markdown-body h5:hover .anchor,.markdown-body h6:hover .anchor{text-decoration:none}.markdown-body h1:hover .anchor .octicon-link,.markdown-body h2:hover .anchor .octicon-link,.markdown-body h3:hover .anchor .octicon-link,.markdown-body h4:hover .anchor .octicon-link,.markdown-body h5:hover .anchor .octicon-link,.markdown-body h6:hover .anchor .octicon-link{visibility:visible}.markdown-body h1 code,.markdown-body h1 tt,.markdown-body h2 code,.markdown-body h2 tt,.markdown-body h3 code,.markdown-body h3 tt,.markdown-body h4 code,.markdown-body h4 tt,.markdown-body h5 code,.markdown-body h5 tt,.markdown-body h6 code,.markdown-body h6 tt{font-size:inherit}.markdown-body h1{font-size:2em}.markdown-body h1,.markdown-body h2{padding-bottom:.3em;border-bottom:1px solid #eee}.markdown-body h2{font-size:1.5em}.markdown-body h3{font-size:1.25em}.markdown-body h4{font-size:1em}.markdown-body h5{font-size:.875em}.markdown-body h6{font-size:.85em;color:#777}.markdown-body ol,.markdown-body ul{padding-left:2em}.markdown-body ol.no-list,.markdown-body ul.no-list{padding:0;list-style-type:none}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:0;margin-bottom:0}.markdown-body li>p{margin-top:16px}.markdown-body li+li{padding-top:.25em}.markdown-body dl{padding:0}.markdown-body dl dt{padding:0;margin-top:16px;font-size:1em;font-style:italic;font-weight:700}.markdown-body dl dd{padding:0 16px;margin-bottom:16px}.markdown-body table{display:block;width:100%;overflow:auto;word-break:normal;word-break:keep-all}.markdown-body table th{font-weight:700}.markdown-body table td,.markdown-body table th{padding:6px 13px;border:1px solid #ddd}.markdown-body table tr{background-color:#fff;border-top:1px solid #ccc}.markdown-body table tr:nth-child(2n){background-color:#f8f8f8}.markdown-body img{max-width:100%;box-sizing:content-box;background-color:#fff}.markdown-body img[align=right]{padding-left:20px}.markdown-body img[align=left]{padding-right:20px}.markdown-body .emoji{max-width:none;vertical-align:text-top;background-color:transparent}.markdown-body span.frame{display:block;overflow:hidden}.markdown-body span.frame>span{display:block;float:left;width:auto;padding:7px;margin:13px 0 0;overflow:hidden;border:1px solid #ddd}.markdown-body span.frame span img{display:block;float:left}.markdown-body span.frame span span{display:block;padding:5px 0 0;clear:both;color:#333}.markdown-body span.align-center{display:block;overflow:hidden;clear:both}.markdown-body span.align-center>span{display:block;margin:13px auto 0;overflow:hidden;text-align:center}.markdown-body span.align-center span img{margin:0 auto;text-align:center}.markdown-body span.align-right{display:block;overflow:hidden;clear:both}.markdown-body span.align-right>span{display:block;margin:13px 0 0;overflow:hidden;text-align:right}.markdown-body span.align-right span img{margin:0;text-align:right}.markdown-body span.float-left{display:block;float:left;margin-right:13px;overflow:hidden}.markdown-body span.float-left span{margin:13px 0 0}.markdown-body span.float-right{display:block;float:right;margin-left:13px;overflow:hidden}.markdown-body span.float-right>span{display:block;margin:13px auto 0;overflow:hidden;text-align:right}.markdown-body code,.markdown-body tt{padding:0;padding-top:.2em;padding-bottom:.2em;margin:0;font-size:85%;background-color:rgba(0,0,0,.04);border-radius:3px}.markdown-body code:after,.markdown-body code:before,.markdown-body tt:after,.markdown-body tt:before{letter-spacing:-.2em;content:"\00a0"}.markdown-body code br,.markdown-body tt br{display:none}.markdown-body del code{text-decoration:inherit}.markdown-body pre{word-wrap:normal}.markdown-body pre>code{padding:0;margin:0;font-size:100%;word-break:normal;white-space:pre;background:transparent;border:0}.markdown-body .highlight{margin-bottom:16px}.markdown-body .highlight pre{margin-bottom:0;word-break:normal}.markdown-body .highlight pre,.markdown-body pre{padding:16px;overflow:auto;font-size:85%;line-height:1.45;background-color:#f7f7f7;border-radius:3px}.markdown-body pre code,.markdown-body pre tt{display:inline;max-width:auto;padding:0;margin:0;overflow:visible;line-height:inherit;word-wrap:normal;background-color:transparent;border:0}.markdown-body pre code:after,.markdown-body pre code:before,.markdown-body pre tt:after,.markdown-body pre tt:before{content:normal}.markdown-body .csv-data td,.markdown-body .csv-data th{padding:5px;overflow:hidden;font-size:12px;line-height:1;text-align:left;white-space:nowrap}.markdown-body .csv-data .blob-line-num{padding:10px 8px 9px;text-align:right;background:#fff;border:0}.markdown-body .csv-data tr{border-top:0}.markdown-body .csv-data th{font-weight:700;background:#f8f8f8;border-top:0}.news .alert .markdown-body blockquote{padding:0 0 0 40px;border:0 none}.activity-tab .news .alert .commits,.activity-tab .news .markdown-body blockquote{padding-left:0}.task-list-item{list-style-type:none}.task-list-item label{font-weight:400}.task-list-item.enabled label{cursor:pointer}.task-list-item+.task-list-item{margin-top:3px}.task-list-item-checkbox{float:left;margin:.31em 0 .2em -1.3em!important;vertical-align:middle;cursor:default!important}.markdown-body{padding-top:40px;padding-bottom:40px;max-width:758px;overflow:visible!important;position:relative}.markdown-body .emoji{vertical-align:top}.markdown-body pre{border:inherit!important}.markdown-body code{color:inherit!important}.markdown-body pre code .wrapper{display:-moz-inline-flex;display:-ms-inline-flex;display:-o-inline-flex;display:inline-flex}.markdown-body pre code .gutter{float:left;overflow:hidden;-webkit-user-select:none;user-select:none}.markdown-body pre code .gutter.linenumber{text-align:right;position:relative;display:inline-block;cursor:default;z-index:4;padding:0 8px 0 0;min-width:20px;box-sizing:content-box;color:#afafaf!important;border-right:3px solid #6ce26c!important}.markdown-body pre code .gutter.linenumber>span:before{content:attr(data-linenumber)}.markdown-body pre code .code{float:left;margin:0 0 0 16px}.markdown-body .gist .line-numbers{border-left:none;border-top:none;border-bottom:none}.markdown-body .gist .line-data{border:none}.markdown-body .gist table{border-spacing:0;border-collapse:inherit!important}.markdown-body code[data-gist-id]{background:none;padding:0}.markdown-body code[data-gist-id]:after,.markdown-body code[data-gist-id]:before{content:""}.markdown-body code[data-gist-id] .blob-num{border:unset}.markdown-body code[data-gist-id] table{overflow:unset;margin-bottom:unset}.markdown-body code[data-gist-id] table tr{background:unset}.markdown-body[dir=rtl] pre{direction:ltr}.markdown-body[dir=rtl] code{direction:ltr;unicode-bidi:embed}.markdown-body .alert>p:last-child{margin-bottom:0}.markdown-body pre.abc,.markdown-body pre.flow-chart,.markdown-body pre.graphviz,.markdown-body pre.mermaid,.markdown-body pre.sequence-diagram,.markdown-body pre.vega{text-align:center;background-color:inherit;border-radius:0;white-space:inherit;overflow:visible}.markdown-body pre.abc>code,.markdown-body pre.flow-chart>code,.markdown-body pre.graphviz>code,.markdown-body pre.mermaid>code,.markdown-body pre.sequence-diagram>code,.markdown-body pre.vega>code{text-align:left}.markdown-body pre.abc>svg,.markdown-body pre.flow-chart>svg,.markdown-body pre.graphviz>svg,.markdown-body pre.mermaid>svg,.markdown-body pre.sequence-diagram>svg,.markdown-body pre.vega>svg{max-width:100%;height:100%}.markdown-body pre>code.wrap{white-space:pre-wrap;white-space:-moz-pre-wrap;white-space:-pre-wrap;white-space:-o-pre-wrap;word-wrap:break-word}.markdown-body .alert>p:last-child,.markdown-body .alert>ul:last-child{margin-bottom:0}.markdown-body summary{display:list-item}.markdown-body summary:focus{outline:none}.markdown-body details summary{cursor:pointer}.markdown-body details:not([open])>:not(summary){display:none}.markdown-body figure{margin:1em 40px}.markdown-body .mark,.markdown-body mark{background-color:#fff1a7}.vimeo,.youtube{cursor:pointer;display:table;text-align:center;background-position:50%;background-repeat:no-repeat;background-size:contain;background-color:#000;overflow:hidden}.vimeo,.youtube{position:relative;width:100%}.youtube{padding-bottom:56.25%}.vimeo img{width:100%;object-fit:contain;z-index:0}.youtube img{object-fit:cover;z-index:0}.vimeo iframe,.youtube iframe,.youtube img{width:100%;height:100%;position:absolute;top:0;left:0}.vimeo iframe,.youtube iframe{vertical-align:middle;z-index:1}.vimeo .icon,.youtube .icon{position:absolute;height:auto;width:auto;top:50%;left:50%;transform:translate(-50%,-50%);color:#fff;opacity:.3;transition:opacity .2s;z-index:0}.vimeo:hover .icon,.youtube:hover .icon{opacity:.6;transition:opacity .2s}.slideshare .inner,.speakerdeck .inner{position:relative;width:100%}.slideshare .inner iframe,.speakerdeck .inner iframe{position:absolute;top:0;bottom:0;left:0;right:0;width:100%;height:100%}.figma{display:table;position:relative;width:100%;padding-bottom:56.25%}.figma iframe{position:absolute;top:0;bottom:0;left:0;right:0;width:100%;height:100%;border:1px solid #eee}.markmap-container{height:300px}.markmap-container>svg{width:100%;height:100%}.MJX_Assistive_MathML{display:none}#MathJax_Message{z-index:1000!important}.ui-infobar{position:relative;z-index:2;max-width:760px;margin:25px auto -25px;color:#777}.toc .invisable-node{list-style-type:none}.ui-toc{position:fixed;bottom:20px;z-index:998}.ui-toc.both-mode{margin-left:8px}.ui-toc.both-mode .ui-toc-label{height:40px;padding:10px 4px;border-top-left-radius:0;border-bottom-left-radius:0}.ui-toc-label{background-color:#e6e6e6;border:none;color:#868686;transition:opacity .2s}.ui-toc .open .ui-toc-label{opacity:1;color:#fff;transition:opacity .2s}.ui-toc-label:focus{opacity:.3;background-color:#ccc;color:#000}.ui-toc-label:hover{opacity:1;background-color:#ccc;transition:opacity .2s}.ui-toc-dropdown{margin-top:20px;margin-bottom:20px;padding-left:10px;padding-right:10px;max-width:45vw;width:25vw;max-height:70vh;overflow:auto;text-align:inherit}.ui-toc-dropdown>.toc{max-height:calc(70vh - 100px);overflow:auto}.ui-toc-dropdown[dir=rtl] .nav{padding-right:0;letter-spacing:.0029em}.ui-toc-dropdown a{overflow:hidden;text-overflow:ellipsis;white-space:pre}.ui-toc-dropdown .nav>li>a{display:block;padding:4px 20px;font-size:13px;font-weight:500;color:#767676}.ui-toc-dropdown .nav>li:first-child:last-child>ul,.ui-toc-dropdown .toc.expand ul{display:block}.ui-toc-dropdown .nav>li>a:focus,.ui-toc-dropdown .nav>li>a:hover{padding-left:19px;color:#000;text-decoration:none;background-color:transparent;border-left:1px solid #000}.ui-toc-dropdown[dir=rtl] .nav>li>a:focus,.ui-toc-dropdown[dir=rtl] .nav>li>a:hover{padding-right:19px;border-left:none;border-right:1px solid #000}.ui-toc-dropdown .nav>.active:focus>a,.ui-toc-dropdown .nav>.active:hover>a,.ui-toc-dropdown .nav>.active>a{padding-left:18px;font-weight:700;color:#000;background-color:transparent;border-left:2px solid #000}.ui-toc-dropdown[dir=rtl] .nav>.active:focus>a,.ui-toc-dropdown[dir=rtl] .nav>.active:hover>a,.ui-toc-dropdown[dir=rtl] .nav>.active>a{padding-right:18px;border-left:none;border-right:2px solid #000}.ui-toc-dropdown .nav .nav{display:none;padding-bottom:10px}.ui-toc-dropdown .nav>.active>ul{display:block}.ui-toc-dropdown .nav .nav>li>a{padding-top:1px;padding-bottom:1px;padding-left:30px;font-size:12px;font-weight:400}.ui-toc-dropdown[dir=rtl] .nav .nav>li>a{padding-right:30px}.ui-toc-dropdown .nav .nav>li>ul>li>a{padding-top:1px;padding-bottom:1px;padding-left:40px;font-size:12px;font-weight:400}.ui-toc-dropdown[dir=rtl] .nav .nav>li>ul>li>a{padding-right:40px}.ui-toc-dropdown .nav .nav>li>a:focus,.ui-toc-dropdown .nav .nav>li>a:hover{padding-left:29px}.ui-toc-dropdown[dir=rtl] .nav .nav>li>a:focus,.ui-toc-dropdown[dir=rtl] .nav .nav>li>a:hover{padding-right:29px}.ui-toc-dropdown .nav .nav>li>ul>li>a:focus,.ui-toc-dropdown .nav .nav>li>ul>li>a:hover{padding-left:39px}.ui-toc-dropdown[dir=rtl] .nav .nav>li>ul>li>a:focus,.ui-toc-dropdown[dir=rtl] .nav .nav>li>ul>li>a:hover{padding-right:39px}.ui-toc-dropdown .nav .nav>.active:focus>a,.ui-toc-dropdown .nav .nav>.active:hover>a,.ui-toc-dropdown .nav .nav>.active>a{padding-left:28px;font-weight:500}.ui-toc-dropdown[dir=rtl] .nav .nav>.active:focus>a,.ui-toc-dropdown[dir=rtl] .nav .nav>.active:hover>a,.ui-toc-dropdown[dir=rtl] .nav .nav>.active>a{padding-right:28px}.ui-toc-dropdown .nav .nav>.active>.nav>.active:focus>a,.ui-toc-dropdown .nav .nav>.active>.nav>.active:hover>a,.ui-toc-dropdown .nav .nav>.active>.nav>.active>a{padding-left:38px;font-weight:500}.ui-toc-dropdown[dir=rtl] .nav .nav>.active>.nav>.active:focus>a,.ui-toc-dropdown[dir=rtl] .nav .nav>.active>.nav>.active:hover>a,.ui-toc-dropdown[dir=rtl] .nav .nav>.active>.nav>.active>a{padding-right:38px}.markdown-body{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Helvetica Neue,Helvetica,Roboto,Arial,sans-serif}html[lang^=ja] .markdown-body{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Helvetica Neue,Helvetica,Roboto,Arial,Hiragino Kaku Gothic Pro,ヒラギノ角ゴ Pro W3,Osaka,Meiryo,メイリオ,MS Gothic,ＭＳ\ ゴシック,sans-serif}html[lang=zh-tw] .markdown-body{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Helvetica Neue,Helvetica,Roboto,Arial,PingFang TC,Microsoft JhengHei,微軟正黑,sans-serif}html[lang=zh-cn] .markdown-body{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Helvetica Neue,Helvetica,Roboto,Arial,PingFang SC,Microsoft YaHei,微软雅黑,sans-serif}html .markdown-body[lang^=ja]{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Helvetica Neue,Helvetica,Roboto,Arial,Hiragino Kaku Gothic Pro,ヒラギノ角ゴ Pro W3,Osaka,Meiryo,メイリオ,MS Gothic,ＭＳ\ ゴシック,sans-serif}html .markdown-body[lang=zh-tw]{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Helvetica Neue,Helvetica,Roboto,Arial,PingFang TC,Microsoft JhengHei,微軟正黑,sans-serif}html .markdown-body[lang=zh-cn]{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Helvetica Neue,Helvetica,Roboto,Arial,PingFang SC,Microsoft YaHei,微软雅黑,sans-serif}html[lang^=ja] .ui-toc-dropdown{font-family:Source Sans Pro,Helvetica,Arial,Meiryo UI,MS PGothic,ＭＳ\ Ｐゴシック,sans-serif}html[lang=zh-tw] .ui-toc-dropdown{font-family:Source Sans Pro,Helvetica,Arial,Microsoft JhengHei UI,微軟正黑UI,sans-serif}html[lang=zh-cn] .ui-toc-dropdown{font-family:Source Sans Pro,Helvetica,Arial,Microsoft YaHei UI,微软雅黑UI,sans-serif}html .ui-toc-dropdown[lang^=ja]{font-family:Source Sans Pro,Helvetica,Arial,Meiryo UI,MS PGothic,ＭＳ\ Ｐゴシック,sans-serif}html .ui-toc-dropdown[lang=zh-tw]{font-family:Source Sans Pro,Helvetica,Arial,Microsoft JhengHei UI,微軟正黑UI,sans-serif}html .ui-toc-dropdown[lang=zh-cn]{font-family:Source Sans Pro,Helvetica,Arial,Microsoft YaHei UI,微软雅黑UI,sans-serif}.ui-affix-toc{position:fixed;top:0;max-width:15vw;max-height:70vh;overflow:auto}.back-to-top,.expand-toggle,.go-to-bottom{display:block;padding:4px 10px;margin-top:10px;margin-left:10px;font-size:12px;font-weight:500;color:#999}.back-to-top:focus,.back-to-top:hover,.expand-toggle:focus,.expand-toggle:hover,.go-to-bottom:focus,.go-to-bottom:hover{color:#563d7c;text-decoration:none}.back-to-top,.go-to-bottom{margin-top:0}.ui-user-icon{width:20px;height:20px;display:block;border-radius:50%;margin-top:2px;margin-bottom:2px;margin-right:5px;background-position:50%;background-repeat:no-repeat;background-size:cover}.ui-user-icon.small{width:18px;height:18px;display:inline-block;vertical-align:middle;margin:0 0 .2em}.ui-infobar>small>span{line-height:22px}.ui-infobar>small .dropdown{display:inline-block}.ui-infobar>small .dropdown a:focus,.ui-infobar>small .dropdown a:hover{text-decoration:none}.ui-more-info{color:#888;cursor:pointer;vertical-align:middle}.ui-more-info .fa{font-size:16px}.ui-connectedGithub,.ui-published-note{color:#888}.ui-connectedGithub{line-height:23px;white-space:nowrap}.ui-connectedGithub a.file-path{color:#888;text-decoration:none;padding-left:22px}.ui-connectedGithub a.file-path:active,.ui-connectedGithub a.file-path:hover{color:#888;text-decoration:underline}.ui-connectedGithub .fa{font-size:20px}.ui-published-note .fa{font-size:20px;vertical-align:top}.unselectable{-webkit-user-select:none;-o-user-select:none;user-select:none}.selectable{-webkit-user-select:text;-o-user-select:text;user-select:text}.inline-spoiler-section{cursor:pointer}.inline-spoiler-section .spoiler-text{border-radius:2px;background-color:#333}.inline-spoiler-section .spoiler-text>*{opacity:0}.inline-spoiler-section .spoiler-img{filter:blur(10px)}.inline-spoiler-section.raw{border-radius:2px;background-color:#333}.inline-spoiler-section.raw>*{opacity:0}.inline-spoiler-section.unveil{cursor:auto}.inline-spoiler-section.unveil .spoiler-text{background-color:rgba(51,51,51,.1)}.inline-spoiler-section.unveil .spoiler-text>*{opacity:1}.inline-spoiler-section.unveil .spoiler-img{filter:none}@media print{blockquote,div,img,pre,table{page-break-inside:avoid!important}a[href]:after{font-size:12px!important}}.markdown-body.slides{position:relative;z-index:1;color:#222}.markdown-body.slides:before{content:"";display:block;position:absolute;top:0;left:0;right:0;bottom:0;z-index:-1;background-color:currentColor;box-shadow:0 0 0 50vw}.markdown-body.slides section[data-markdown]{position:relative;margin-bottom:1.5em;background-color:#fff;text-align:center}.markdown-body.slides section[data-markdown] code{text-align:left}.markdown-body.slides section[data-markdown]:before{content:"";display:block;padding-bottom:56.23%}.markdown-body.slides section[data-markdown]>div:first-child{position:absolute;top:50%;left:1em;right:1em;transform:translateY(-50%);max-height:100%;overflow:hidden}.markdown-body.slides section[data-markdown]>ul{display:inline-block}.markdown-body.slides>section>section+section:after{content:"";position:absolute;top:-1.5em;right:1em;height:1.5em;border:3px solid #777}.site-ui-font{font-family:Source Sans Pro,Helvetica,Arial,sans-serif}html[lang^=ja] .site-ui-font{font-family:Source Sans Pro,Helvetica,Arial,Hiragino Kaku Gothic Pro,ヒラギノ角ゴ Pro W3,Osaka,Meiryo,メイリオ,MS Gothic,ＭＳ\ ゴシック,sans-serif}html[lang=zh-tw] .site-ui-font{font-family:Source Sans Pro,Helvetica,Arial,PingFang TC,Microsoft JhengHei,微軟正黑,sans-serif}html[lang=zh-cn] .site-ui-font{font-family:Source Sans Pro,Helvetica,Arial,PingFang SC,Microsoft YaHei,微软雅黑,sans-serif}body{font-smoothing:subpixel-antialiased!important;-webkit-font-smoothing:subpixel-antialiased!important;-moz-osx-font-smoothing:auto!important;text-shadow:0 0 1em transparent,1px 1px 1.2px rgba(0,0,0,.004);-webkit-overflow-scrolling:touch;letter-spacing:.025em;font-family:Source Sans Pro,Helvetica,Arial,sans-serif}html[lang^=ja] body{font-family:Source Sans Pro,Helvetica,Arial,Hiragino Kaku Gothic Pro,ヒラギノ角ゴ Pro W3,Osaka,Meiryo,メイリオ,MS Gothic,ＭＳ\ ゴシック,sans-serif}html[lang=zh-tw] body{font-family:Source Sans Pro,Helvetica,Arial,PingFang TC,Microsoft JhengHei,微軟正黑,sans-serif}html[lang=zh-cn] body{font-family:Source Sans Pro,Helvetica,Arial,PingFang SC,Microsoft YaHei,微软雅黑,sans-serif}abbr[title]{border-bottom:none;text-decoration:underline;-webkit-text-decoration:underline dotted;text-decoration:underline dotted}abbr[data-original-title],abbr[title]{cursor:help}body.modal-open{overflow-y:auto;padding-right:0!important}
    </style>
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    	<script src="https://cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv.min.js" integrity="sha256-3Jy/GbSLrg0o9y5Z5n1uw0qxZECH7C6OQpVBgNFYa0g=" crossorigin="anonymous"></script>
    	<script src="https://cdnjs.cloudflare.com/ajax/libs/respond.js/1.4.2/respond.min.js" integrity="sha256-g6iAfvZp+nDQ2TdTR/VVKJf3bGro4ub5fvWSWVRi2NE=" crossorigin="anonymous"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/es5-shim/4.5.9/es5-shim.min.js" integrity="sha256-8E4Is26QH0bD52WoQpcB+R/tcWQtpzlCojrybUd7Mxo=" crossorigin="anonymous"></script>
    <![endif]-->
</head>

<body>
    <div id="doc" class="markdown-body container-fluid comment-enabled" data-hard-breaks="true"><h1 id="CIA-Lab-4---DNSSec-and-DoH" data-id="CIA-Lab-4---DNSSec-and-DoH"><a class="anchor hidden-xs" href="#CIA-Lab-4---DNSSec-and-DoH" title="CIA-Lab-4---DNSSec-and-DoH"><span class="octicon octicon-link"></span></a><span>CIA Lab 4 - DNSSec and DoH</span></h1><p><strong><span>Name: Vladimir Shelkovnikov</span></strong></p><hr><div class="alert alert-success">
<h4 id="Task-1---DNS-Insecurity" data-id="Task-1---DNS-Insecurity"><a class="anchor hidden-xs" href="#Task-1---DNS-Insecurity" title="Task-1---DNS-Insecurity"><span class="octicon octicon-link"></span></a><span>Task 1 - DNS Insecurity</span></h4>
<ul>
<li><span>In what context was the DNS cache poisoning attack  discovered? (Who, when, why)</span></li>
<li><span>How does this attack work and how to prevent it?</span></li>
<li><span>What is DNS spoofing and what tools can be used to  integrate this attack?</span></li>
<li><span>What does a validating resolver do? What is the difference  between island-of-trust versus full-chain-of-trust?</span></li>
<li><span>Does DoH substitute DNSSec or complement it? What  are the differences between them?</span></li>
<li><span>What do you think about DoH vs DoT vs DNSCrypt?</span></li>
</ul>
</div><hr><h2 id="Answers" data-id="Answers"><a class="anchor hidden-xs" href="#Answers" title="Answers"><span class="octicon octicon-link"></span></a><span>Answers</span></h2><hr><blockquote>
<p><span>In what context was the DNS cache poisoning attack  discovered? (Who, when, why)?</span></p>
<blockquote>
<p><span>The DNS cache poisoning attack was discovered by Dan Kaminsky. It was presented at BlackHat 2008. Before 2008, all DNS revolvers used fixed port 53. Therefore with the exception of the transaction ID, all information necessary to spoof a DNS reply is predictable.</span></p>
</blockquote>
</blockquote><hr><blockquote>
<p><span>How does this attack work and how to prevent it?</span></p>
<blockquote>
<p><span>For the attack to succeed, the forged DNS reply must arrive at the target resolver before the legitimate authoritative response does. If the legitimate response arrives first, it will be cached by the resolver, and until its time-to-live (TTL) expires, the resolver will not ask the authoritative server to resolve the same domain name, preventing the attacker from poisoning the mapping for that domain until the TTL expires. It could be done by Impersonating a server, Tying up the server, Exploiting open ports</span></p>
</blockquote>
<blockquote>
<p><span>The best way to prevent Cache Poisoning of DNS revolvers is to implement a secure method of cryptography and authentication. DNS as a protocol is antiquated and as a backbone of the entire internet is surprisingly still an unencrypted protocol without any form of validation for entries and responses it receives.</span></p>
</blockquote>
</blockquote><hr><blockquote>
<p><span>What is DNS spoofing and what tools can be used to integrate this attack?</span></p>
<blockquote>
<p><span>DNS spoofing is when users are redirected to an unsafe website because the DNS poisoning worked, making users susceptible to cyber threats.</span><br>
<span>DNS spoofing can be carried out using various methods such as DNS cache poisoning, compromising a DNS server, implementing a man-in-the-middle attack. The most discussed method to perform DNS spoofing is using cache poisoning</span></p>
</blockquote>
</blockquote><hr><blockquote>
<p><span>What does a validating resolver do? What is the difference between island-of-trust versus full-chain-of-trust?</span></p>
<blockquote>
<p><span>DNSSEC validating resolver check signatures in a signed response. Before the resolver can verify the signature, it must establish trust in this public key (build a chain of trust).</span><br>
<span>An island of trust is a signed delegated zone that does not have an authentication chain from the delegating parent zone. Responses from the islands or its child zones can be authenticated, if their authentication keys can be authenticated, by some reliable means outside of the DNS protocol.</span></p>
</blockquote>
<blockquote>
<p><span>the full chain of trust is an alternating sequence of DNSKEY, RRset, and DS, which form a chain of signed data, each node of the chain confirms the correctness of the previous one.</span></p>
</blockquote>
</blockquote><hr><blockquote>
<p><span>Does DoH substitute DNSSec or complement it? What are the differences between them?</span></p>
<blockquote>
<p><span>DoH sort of complements DNSSEC. DoH protects DNS traffic only at the time of transmission through intermediate nodes; DNSSEC protects the authenticity and immutability of the DNS information itself with the help of an electronic signature mechanism. At the same time, DNSSEC does not hide server requests or responses in any way: the data is transmitted in clear form.</span></p>
</blockquote>
</blockquote><hr><blockquote>
<p><span>What do you think about DoH vs DoT vs DNSCrypt?</span></p>
<blockquote>
<p><span>From the point of view of network security, DoT is probably better. This gives us the ability to monitor and block DNS requests, which is important for detecting and stopping malicious traffic. DoH requests, meanwhile, are hidden in normal HTTPS traffic, which means that they cannot be easily blocked without also blocking all other HTTPS traffic.</span></p>
</blockquote>
<blockquote>
<p><span>However, from a privacy perspective, DoH is probably preferable. With DoH, DNS queries are hidden in a larger stream of HTTPS traffic. This gives network administrators less visibility but provides users with more privacy.</span></p>
</blockquote>
<blockquote>
<p><span>DNSCrypt was a good option, but now it’s dead [13].</span></p>
</blockquote>
</blockquote><hr><h2 id="Task-2---Validation-Resolver" data-id="Task-2---Validation-Resolver"><a class="anchor hidden-xs" href="#Task-2---Validation-Resolver" title="Task-2---Validation-Resolver"><span class="octicon octicon-link"></span></a><span>Task 2 - Validation Resolver</span></h2><div class="alert alert-success">
<h4 id="Setup" data-id="Setup"><a class="anchor hidden-xs" href="#Setup" title="Setup"><span class="octicon octicon-link"></span></a><span>Setup</span></h4>
<ul>
<li><span>Enable DNSSec to your BIND or Unbound and verify the  root key is used as a trusted source.</span></li>
<li><span>Use  dig  or  drill  to verify the validity of DNS records  for  </span><a href="http://isc.org" target="_blank" rel="noopener"><span>isc.org</span></a><span>,  </span><a href="http://sne21.ru" target="_blank" rel="noopener"><span>sne21.ru</span></a></li>
</ul>
<h4 id="Validate" data-id="Validate"><a class="anchor hidden-xs" href="#Validate" title="Validate"><span class="octicon octicon-link"></span></a><span>Validate</span></h4>
<ul>
<li><span>How does  dig  or  drill  show whether DNSSec full-chain-of-trust  validation was successful or not?  Hint: it’s about a flag</span></li>
</ul>
<h4 id="Counter-validate-breaking-the-chain-of-trust" data-id="Counter-validate-breaking-the-chain-of-trust"><a class="anchor hidden-xs" href="#Counter-validate-breaking-the-chain-of-trust" title="Counter-validate-breaking-the-chain-of-trust"><span class="octicon octicon-link"></span></a><span>Counter-validate (breaking the chain of trust)</span></h4>
<ul>
<li><span>Where does BIND or Unbound store the DNSSec root key?</span></li>
<li><span>How do managed keys differ from trusted keys? Which  RFC describes the mechanisms for managed keys?</span></li>
<li><span>Modify the DNSSec root key and test your validating resolver.</span></li>
<li><span>How did your server react?</span></li>
</ul>
</div><hr><center>
<h3 id="Setup1" data-id="Setup"><a class="anchor hidden-xs" href="#Setup1" title="Setup1"><span class="octicon octicon-link"></span></a><span>Setup</span></h3>
</center><hr><p><span>First, I reinstall BIND to version 9.17.17 (Development Release)</span></p><center>
<p><img src="https://i.imgur.com/kCwTgLH.png" alt="" loading="lazy"><br>
<span>Figure 1 - Reinstalled BIND</span></p>
</center><p><span>Then I enabled DNSSEC by adding </span><code>dnssec-validation auto;</code><span> to named.cond.option. After the reboot, I checked the nameserver (Figures 2, 3).</span></p><center>
<p><img src="https://i.imgur.com/lqu6KhJ.png" alt="" loading="lazy"></p>
<p><span>Figure 2 - Verifying the validity of DNS records for </span><a href="http://sne21.ru" target="_blank" rel="noopener"><span>sne21.ru</span></a></p>
<p><img src="https://i.imgur.com/iWx1hql.png" alt="" loading="lazy"><br>
<span>Figure 3 - Verifying the validity of DNS records for </span><a href="http://isc.org" target="_blank" rel="noopener"><span>isc.org</span></a></p>
</center><hr><p><span>First, you need to pass the +dnssec flag to dig into validating the zone data. Secondly, watch out for the ad flag in the output that confirmed the correctness of the zone data. Third, find the RRSIG line of the response. The ad flag means that an authenticated response should be set and the do flag indicating that DNSSEC was ok.</span></p><hr><center>
<h3 id="Counter-validate-breaking-the-chain-of-trust1" data-id="Counter-validate-breaking-the-chain-of-trust"><a class="anchor hidden-xs" href="#Counter-validate-breaking-the-chain-of-trust1" title="Counter-validate-breaking-the-chain-of-trust1"><span class="octicon octicon-link"></span></a><span>Counter-validate (breaking the chain of trust)</span></h3>
</center><hr><blockquote>
<p><span>Where does BIND or Unbound store the DNSSec root key?</span></p>
<blockquote>
<p><span>BIND stores the DNSSec root key at bind.keys.</span></p>
</blockquote>
</blockquote><hr><blockquote>
<p><span>How do managed keys differ from trusted keys? Which RFC describes the mechanisms for managed keys?</span></p>
<blockquote>
<p><span>While trusted-keys and managed-keys appear similar, there is an important difference: trusted-keys are always trusted until they are deleted from named.conf; managed-keys (specifically, initial-key, which is the only supported type currently) are only trusted once: for as long as it takes to load the managed key database and start the key maintenance process [according to RFC 4641].</span></p>
</blockquote>
</blockquote><hr><blockquote>
<p><span>Modify the DNSSec root key and test your validating resolver.</span><br>
<span>Figure 4 shows the result of executing the dig command before changing the root key.</span></p>
</blockquote><center>
<p><img src="https://i.imgur.com/0dDPDBs.png" alt="" loading="lazy"><br>
<span>Figure 4 - Before changing the root key</span></p>
</center><p><span>Figure 5 shows the result after changing the root key.</span></p><center>
<p><img src="https://i.imgur.com/qE9Rh9t.png" alt="" loading="lazy"><br>
<span>Figure 5 - After changing the root key</span></p>
</center><p><span>There is no ad flag here. This means that the zone data is incorrect.</span></p><hr><h2 id="Task-3---Secure-Zone" data-id="Task-3---Secure-Zone"><a class="anchor hidden-xs" href="#Task-3---Secure-Zone" title="Task-3---Secure-Zone"><span class="octicon octicon-link"></span></a><span>Task 3 - Secure Zone</span></h2><div class="alert alert-success">
<h4 id="Island-of-trust" data-id="Island-of-trust"><a class="anchor hidden-xs" href="#Island-of-trust" title="Island-of-trust"><span class="octicon octicon-link"></span></a><span>Island of trust</span></h4>
<ul>
<li><span>Look up which cryptographic algorithms are available  for use in DNSSec. Which one do you prefer, and why?</span></li>
<li><span>What is the difference between Key-Signing Key (KSK)  and Zone-Signing Key (ZSK)?</span></li>
<li><span>Why are those separated and why do those use different  algorithms, key sizes and lifetimes?</span></li>
<li><span>Use BIND9 tools (dnssec−keygen &amp; dnssec−signzone)  or NSD tools (ldns−keygen &amp; ldns−signzone) to secure your zone. Show the configuration  files involved and validate your setup (  </span><a href="https://dnssec-analyzer.verisignlabs.com" target="_blank" rel="noopener"><span>https://dnssec-analyzer.verisignlabs.com</span></a><span>  ,  </span><a href="https://dnsviz.net" target="_blank" rel="noopener"><span>https://dnsviz.net</span></a><span>  ).</span></li>
</ul>
<h4 id="Full-chain-of-trust" data-id="Full-chain-of-trust"><a class="anchor hidden-xs" href="#Full-chain-of-trust" title="Full-chain-of-trust"><span class="octicon octicon-link"></span></a><span>Full chain of trust</span></h4>
<ul>
<li><span>Does your parent zone offer secure delegation?</span></li>
<li><span>Describe the DS and DNSKEY records from  </span><a href="http://sne21.ru" target="_blank" rel="noopener"><span>sne21.ru</span></a><span>  that  are important for your domain. Which keys are used to sign them?</span></li>
</ul>
</div><hr><blockquote>
<p><span>Look up which cryptographic algorithms are available for use in DNSSec. Which one do you prefer, and why?</span></p>
</blockquote><center>
Table 1 - Cryptographic algorithms
<table>
<thead>
<tr>
<th><span>Number</span></th>
<th><span>Algorithm</span></th>
<th><span>Usage</span></th>
</tr>
</thead>
<tbody>
<tr>
<td><span>1</span></td>
<td><span>RSAMD5</span></td>
<td><span>NO</span></td>
</tr>
<tr>
<td><span>2</span></td>
<td><span>DSA</span></td>
<td><span>NO</span></td>
</tr>
<tr>
<td><span>3</span></td>
<td><span>RSASHA1</span></td>
<td><span>NO</span></td>
</tr>
<tr>
<td><span>4</span></td>
<td><span>DSA-NSEC3-SHA1</span></td>
<td><span>NO</span></td>
</tr>
<tr>
<td><span>5</span></td>
<td><span>RSASHA1-NSEC3-SHA1</span></td>
<td><span>NO</span></td>
</tr>
<tr>
<td><span>6</span></td>
<td><span>RSASHA256</span></td>
<td><span>YES</span></td>
</tr>
<tr>
<td><span>7</span></td>
<td><span>RSASHA512</span></td>
<td><span>No</span></td>
</tr>
<tr>
<td><span>8</span></td>
<td><span>ECC-GOST</span></td>
<td><span>No</span></td>
</tr>
<tr>
<td><span>9</span></td>
<td><span>ECDSAP256SHA256</span></td>
<td><span>YES</span></td>
</tr>
<tr>
<td><span>10</span></td>
<td><span>ECDSAP384SHA384</span></td>
<td><span>YES</span></td>
</tr>
<tr>
<td><span>11</span></td>
<td><span>ED25519</span></td>
<td><span>YES</span></td>
</tr>
<tr>
<td><span>12</span></td>
<td><span>ED448</span></td>
<td><span>YES</span></td>
</tr>
</tbody>
</table>
</center><blockquote>
<blockquote>
<p><span>The first five of the algorithms are vulnerable to modern usage.</span><br>
<span>Generating keys and zone signature. RSASHA256 is in wide use and considered strong. I can not recommend RSASHA512 for DNSSEC signing, because it has not been widely deployed. ECC-GOST is still not standardized for use in DNSSEC.</span><br>
<span>ECDSAP256SHA256 and ECDSAP384SHA384 provide more strength for signature size than RSASHA. Both of them were also widely deployed.</span><br>
<span>ED25519 and ED448 are the most promising for use in DNSSEC verification, but they are not so widely deployed now.</span></p>
</blockquote>
</blockquote><hr><blockquote>
<p><span>What is the difference between Key-Signing Key (KSK) and Zone-Signing Key (ZSK)?</span></p>
<blockquote>
<p><span>The ZSK key is used to sign all record sets in the zone (RRset), except for delegation points.</span><br>
<span>A set of DNSKEY records is signed with the KSK key.</span><br>
<span>In addition, a hash is taken from the open part of the KSK, which is then sent to the parent zone (DS record).</span></p>
</blockquote>
</blockquote><hr><blockquote>
<p><span>Why are those separated and why do those use different algorithms, key sizes, and lifetimes?</span></p>
<blockquote>
<p><span>Changing the DS record is a multi-step process that can end up breaking the zone if it’s performed incorrectly. First, the parent needs to add the new DS record, then they need to wait until the TTL for the original DS record expires before removing it. This is why it’s much easier to swap out ZSK than KSK. One of the advantages of having separate ZSKs and KSKs is a better balance between security and ease of use: the KSK can be stored in a secure and less accessible area, while the ZSK is easily accessible for routine use.</span><br>
<span>The larger the key size, the longer it takes for an attacker to crack the key; but larger keys also mean more resources are needed both when generating signatures (authoritative servers) and verifying signatures (recursive servers).</span></p>
</blockquote>
</blockquote><hr><center>
<h4 id="Zone-signing" data-id="Zone-signing"><a class="anchor hidden-xs" href="#Zone-signing" title="Zone-signing"><span class="octicon octicon-link"></span></a><span>Zone signing</span></h4>
</center><hr><p><span>First, I generated KSK and ZSK as shown in Figure 6.</span></p><center>
<p><img src="https://i.imgur.com/K33Na9H.png" alt="" loading="lazy"><br>
<span>Figure 6 - Generating ZSK and KSK</span></p>
</center><p><span>Then I added it to the zone file </span><code>db.st12.sne21.ru</code><span>. then I signed zone with salt DEAD (Figure 7).</span></p><center>
<p><img src="https://i.imgur.com/W663EdA.png" alt="" loading="lazy"><br>
<span>Figure 7 - Signing the </span><a href="http://st12.sne21.ru" target="_blank" rel="noopener"><span>st12.sne21.ru</span></a><span> zone</span></p>
</center><p><span>This created a DS record (dsset) and a signed zone file. I have set the signed file as a file at named.conf (Figure 8).</span></p><center>
<p><img src="https://i.imgur.com/9aHFDST.png" alt="" loading="lazy"><br>
<span>Figure 8 - named.conf.default-zones</span></p>
</center><p><span>Figure 9 shows </span><a href="http://db.st12.sne21.ru" target="_blank" rel="noopener"><span>db.st12.sne21.ru</span></a><span> a file with the recorded keys.</span></p><center>
<p><img src="https://i.imgur.com/TQ235Ya.png" alt="" loading="lazy"><br>
<span>Figure 9 - </span><a href="http://db.st12.sne21.ru" target="_blank" rel="noopener"><span>db.st12.sne21.ru</span></a></p>
</center><p><span>Figure 10 shows the DS record.</span></p><center>
<p><img src="https://i.imgur.com/HSqWC5p.png" alt="" loading="lazy"><br>
<span>Figure 10 - DS record</span></p>
</center><p><span>Figure 11 shows the db.st12.sne21.ru.signed file. RRSIG, DNSKEY, and NSEC records have been added here</span></p><center>
<p><img src="https://i.imgur.com/9zSak6H.png" alt="" loading="lazy"><br>
<span>Figure 11 - db.st12.sne21.ru.signed</span></p>
</center><p><span>I validated my setup by running the delv command (Figure 12).</span></p><center>
<p><img src="https://i.imgur.com/tlPEHCs.png" alt="" loading="lazy"><br>
<span>Figure 12 - Validating my setup</span></p>
</center><p><span>delv is a tool for sending DNS queries and validating the results, using the same internal resolver and validator logic as named.</span></p><hr><center>
<h4 id="Full-chain-of-trust1" data-id="Full-chain-of-trust"><a class="anchor hidden-xs" href="#Full-chain-of-trust1" title="Full-chain-of-trust1"><span class="octicon octicon-link"></span></a><span>Full chain of trust</span></h4>
</center><hr><blockquote>
<p><span>Does your parent zone offer secure delegation?</span></p>
<blockquote>
<p><span>Yes, by adding the NS record, glued A record and the DS record to </span><a href="http://sne21.ru" target="_blank" rel="noopener"><span>sne21.ru</span></a><span> domain.</span></p>
</blockquote>
</blockquote><hr><blockquote>
<p><span>Describe the DS and DNSKEY records from </span><a href="http://sne21.ru" target="_blank" rel="noopener"><span>sne21.ru</span></a><span> that are important for your domain. Which keys are used to sign them?</span></p>
<blockquote>
<p><span>Every time a resolver is referred to a child zone, the parent zone also provides a DS record. This record shows that the child zone is enabled with DNSSEC support. To check the validity of the KSK (child), the resolver hashes it and compares it to the DS record. If they match, the resolver will trust all of the records in the child zone.</span></p>
</blockquote>
</blockquote><hr><h2 id="Task-4---Key-Rollovers" data-id="Task-4---Key-Rollovers"><a class="anchor hidden-xs" href="#Task-4---Key-Rollovers" title="Task-4---Key-Rollovers"><span class="octicon octicon-link"></span></a><span>Task 4 - Key Rollovers</span></h2><div class="alert alert-success">
<h4 id="Zone-Signing-Key-rollover" data-id="Zone-Signing-Key-rollover"><a class="anchor hidden-xs" href="#Zone-Signing-Key-rollover" title="Zone-Signing-Key-rollover"><span class="octicon octicon-link"></span></a><span>Zone-Signing Key rollover</span></h4>
<ul>
<li><span>Study RFC 6781 or affiliated online resources</span></li>
<li><span>What are the options for doing a ZSK rollover? Choose one procedure and motivate your choice.</span></li>
<li><span>How would you integrate this procedure with the tools for signing your zone? Which timers are important?</span></li>
<li><span>Bonus (1 point) : integrate the procedure and use a DNSSec debugger to verify each step</span></li>
</ul>
<h4 id="Key-Signing-Key-rollover" data-id="Key-Signing-Key-rollover"><a class="anchor hidden-xs" href="#Key-Signing-Key-rollover" title="Key-Signing-Key-rollover"><span class="octicon octicon-link"></span></a><span>Key-Signing Key rollover</span></h4>
<ul>
<li><span>Can you use the same procedure for a KSK rollover?</span></li>
<li><span>What does this depend on?</span></li>
</ul>
</div><hr><blockquote>
<p><span>What are the options for doing a ZSK rollover? Choose one procedure and motivate your choice.</span></p>
<blockquote>
<p><span>There are two options:</span></p>
<ul>
<li><span>Pre-Publish Zone Signing Key Rollover - 4 stages, before the actual rollover, the new key is published in the key set;</span></li>
<li><span>Double-Signature Zone Signing Key Rollover - signing the zone data twice, 3 stages.</span></li>
</ul>
</blockquote>
<blockquote>
<p><span>I choose the second option because I have a small zone, and, in my opinion, it is easy to implement it.</span></p>
</blockquote>
</blockquote><hr><blockquote>
<p><span>How would you integrate this procedure with the tools for signing your zone? Which timers are important?</span></p>
<blockquote>
<p><span>To implement it, I need the dnssec-settime and dnssec-keygen tools.</span><br>
<span>There are 4 timers (Inactive and deleted are the most important because the default key does not have these timers):</span></p>
<ul>
<li><span>Publish: The time at which the key is publicly available in the zone</span></li>
<li><span>Activate: From this time on it is used to sign RRs</span></li>
<li><span>Inactive: No longer used to sign</span></li>
<li><span>Delete: Removed from the zone</span><br>
<span>I will set inactive and delete timers for my ZSK key, then create a new one with the -S flag, which will create a new key that is an explicit successor to the existing key. The name, algorithm, size, and type of the key will be set according to the existing key.</span></li>
</ul>
</blockquote>
</blockquote><hr><center>
<h4 id="Bonus" data-id="Bonus"><a class="anchor hidden-xs" href="#Bonus" title="Bonus"><span class="octicon octicon-link"></span></a><span>Bonus</span></h4>
</center><hr><p><span>Figure 13 shows the ZSK key without -I and -D timers.</span></p><center>
<p><img src="https://i.imgur.com/vFRs7fq.png" alt="" loading="lazy"><br>
<span>Figure 13 - ZSK key without timers</span></p>
</center><p><span>I have established that the existing ZSK key will be inactive after three months and deleted after 4 - </span><code>sudo dnssec-settime -I +3mo -D +4mo Kst12.sne21.ru.+008+43978</code><span>. Figure 14 shows the result.</span></p><center>
<p><img src="https://i.imgur.com/eBwCw1Z.png" alt="" loading="lazy"><br>
<span>Figure 14 - ZSk key with timers</span></p>
</center><p><span>Figure 15 shows the DNSSEC authentication chain before adding other keys.</span></p><center>
<p><img src="https://i.imgur.com/CkkSbyS.png" alt="" loading="lazy"><br>
<span>Figure 15 - DNSSEC Authentication Chain</span></p>
</center><div class="alert alert-info">
<p><span>I wanted to use dnsviz, but for some reason, it doesn’t show the new keys.</span></p>
<p><span>Only the inactive and delete dates must be set to generate a new key, the publish and activate dates are set automatically.</span></p>
</div><p><span>I want to use ZSK rollover every 3 months, so I created the following key (Figure 16):</span><br>
<code>sudo dnssec-keygen -S Kst12.sne21.ru.+008+43978 -I +7mo -D +9mo</code></p><center>
<p><img src="https://i.imgur.com/UOsqefI.png" alt="" loading="lazy"><br>
<span>Figure 16 - new ZSK key</span></p>
</center><p><span>That is: this new key will be published 1 month before the first key is “inactive”, used in 4 months (because the first key is inactive in 4 months),</span><br>
<span>inactive in 7 months, and deleted 1 month after inactive.</span></p><p><span>I uploaded this key to the zone file - rndc loadkeys </span><a href="http://st12.sne21.ru" target="_blank" rel="noopener"><span>st12.sne21.ru</span></a></p><p><span>Also, it is better to create the last one without inactive and deleted timers </span><code>sudo dnssec-keygen -S Kst12.sne21.ru.+008+51591</code><span> (Figure 17).</span></p><center>
<p><img src="https://i.imgur.com/m757S3d.png" alt="" loading="lazy"><br>
<span>Figure 17 - Last ZSK key</span></p>
</center><hr><center>
<h4 id="Key-Signing-Key-rollover1" data-id="Key-Signing-Key-rollover"><a class="anchor hidden-xs" href="#Key-Signing-Key-rollover1" title="Key-Signing-Key-rollover1"><span class="octicon octicon-link"></span></a><span>Key-Signing Key rollover</span></h4>
</center><hr><blockquote>
<p><span>Can you use the same procedure for a KSK rollover? What does this depend on?</span></p>
<blockquote>
<p><span>Yes, but it depends on DS RR. We can use the same procedure which puts the responsibility for maintaining a valid chain of trust with the child. It also is based on the premise that the parent only has one DS RR (per algorithm) per zone.  An alternative mechanism is the KSK Double-DS rollover.</span></p>
</blockquote>
</blockquote><hr><h2 id="Task-5---DNS-over-HTTPS" data-id="Task-5---DNS-over-HTTPS"><a class="anchor hidden-xs" href="#Task-5---DNS-over-HTTPS" title="Task-5---DNS-over-HTTPS"><span class="octicon octicon-link"></span></a><span>Task 5 - DNS-over-HTTPS</span></h2><div class="alert alert-success">
<p><span>Implementing DNS-over-HTTPS on your server.</span></p>
<ul>
<li><span>For this step you probably will need to recompile and reinstall your server (unbound requires --with-libnghttp2 flag and BIND requires Development Release).</span></li>
<li><span>Also, you will need a certificate for your domain, you can use certbot to obtain it.</span></li>
<li><span>Show configuration options that have to be tuned.</span></li>
<li><span>Verify that DNS-over-HTTPS is working (Chrome and Firefox has support for it) by inspecting server incoming queries in the log.</span></li>
</ul>
</div><hr><p><span>I installed certbot (figure 17)</span></p><center>
<p><img src="https://i.imgur.com/E6Qy3PE.png" alt="" loading="lazy"><br>
<span>Figure 17 - installed certbot</span></p>
</center><p><span>Then I created a certificate for the </span><a href="http://st12.sne21.ru" target="_blank" rel="noopener"><span>st12.sne21.ru</span></a><span> domain (Figure 18).</span></p><p><code>sudo certbot certonly --standalone --preferred-challenges http --agree-tos --email vovacet12@mail.ru -d st12.sne21.ru</code><span>.</span></p><center>
<p><img src="https://i.imgur.com/Z6A4Jcw.png" alt="" loading="lazy"><br>
<span>Figure 18 - Creating the certificate for the domain</span></p>
</center><p><span>Then I fixed the permissions on the live and archive folders so that named has permission to read these files:</span></p><p><span>sudo chmod 0755 /etc/letsencrypt/live</span><br>
<span>sudo chmod 0755 /etc/letsencrypt/archive</span></p><p><span>Also, I to chang the group and permissions for the private key file</span></p><p><span>sudo chgrp bind /etc/letsencrypt/live/st12.sne21.ru/privkey.pem</span><br>
<span>sudo chmod 0640 /etc/letsencrypt/live/st12.sne21.ru/privkey.pem</span></p><p><span>After that, I reconfigured Apparmor to allow </span><code>named</code><span> access to the Lets’encrypt folder (Figure 19).</span></p><center>
<p><img src="https://i.imgur.com/HV353jz.png" alt="" loading="lazy"><br>
<span>Figure 19 - Configuration of Apparmor</span></p>
</center><p><span>Then I added the necessary lines to “named. conf. options” to enable DoH (figure 20).</span></p><center>
<p><img src="https://i.imgur.com/slSra4V.png" alt="" loading="lazy"><br>
<span>Figure 20 - enable DoH</span></p>
</center><p><span>Figures 21 and 22 show the test of connection.</span></p><center>
<p><img src="https://i.imgur.com/1TbcBWo.png" alt="" loading="lazy"></p>
<p><span>Figure 21 - dig https</span></p>
<p><img src="https://i.imgur.com/f1ZweXp.png" alt="" loading="lazy"></p>
<p><span>Figure 22 - log</span></p>
</center><h2 id="Task-6---Secure-Zone-Delegation-2-points" data-id="Task-6---Secure-Zone-Delegation-2-points"><a class="anchor hidden-xs" href="#Task-6---Secure-Zone-Delegation-2-points" title="Task-6---Secure-Zone-Delegation-2-points"><span class="octicon octicon-link"></span></a><span>Task 6 - Secure Zone Delegation (2 points)</span></h2><div class="alert alert-success">
<ul>
<li><span>Securely delegate a subzone to another student - st</span>&lt;X&gt;<span>.st</span>&lt;Y&gt;<span>.sne21.ru , where X - the number of your machine, Y - the number of your partner’s machine.</span></li>
<li><span>How to communicate the necessary record to your buddy? (Integrity matters here)</span></li>
<li><span>What about Confidentiality, does it matter here?</span></li>
</ul>
</div><hr><p><span>First we created subdomains st12.st9 (Figure 23) and st9.st12 (Figure 24).</span></p><center>
<p><img src="https://i.imgur.com/5nO3yZC.png" alt="" loading="lazy"><br>
<span>Figure 22 - zone </span><a href="http://st12.st9.sne21.ru" target="_blank" rel="noopener"><span>st12.st9.sne21.ru</span></a></p>
<p><img src="https://i.imgur.com/2Mc6JOm.png" alt="" loading="lazy"><br>
<span>Figure 23 - zone </span><a href="http://st9.st12.sne21.ru" target="_blank" rel="noopener"><span>st9.st12.sne21.ru</span></a></p>
</center><p><span>Then we changed the zone file by adding an NS record, glued A record and the DS record (Figure 24). I also added a subdomain to the named.conf.default zones.</span></p><center>
<p><img src="https://i.imgur.com/ggcTDwc.png" alt="" loading="lazy"><br>
<span>Figure 24 - Changed zone file</span></p>
</center><center>
<p><img src="https://i.imgur.com/ZpFxiXK.png" alt="" loading="lazy"><br>
<span>Figure 25 - Request from st9 to st12</span></p>
</center><hr><blockquote>
<p><span>How to communicate the necessary record to your buddy? (Integrity matters here).</span></p>
<blockquote>
<p><span>I created a subdomain of his zone and signed it. He added the DS,NS and A records to his zone. After that, the subdomain sends its DNSKEY to the domain. The domain hashed it and compared it with the DS record.</span></p>
</blockquote>
</blockquote><blockquote>
<p><span>What about Confidentiality, does it matter here?</span></p>
<blockquote>
<p><span>DNSSEC does not provide confidentiality.</span></p>
</blockquote>
</blockquote><hr><h2 id="Task-7---NSEC-vs-NSEC3" data-id="Task-7---NSEC-vs-NSEC3"><a class="anchor hidden-xs" href="#Task-7---NSEC-vs-NSEC3" title="Task-7---NSEC-vs-NSEC3"><span class="octicon octicon-link"></span></a><span>Task 7 - NSEC vs NSEC3</span></h2><div class="alert alert-success">
<p><span>NSEC is used to prove that a certain resource record does not exist. A nasty side effect of NSEC is that it enables zone traversal.</span><br>
<span>Using NSEC3, a DNS server can prove the non-existence of a resource record without facilitating zone traversal.</span></p>
<ul>
<li><span>What are the main differences between NSEC and NSEC3?</span></li>
<li><span>How to select one or the other during zone-signing?</span></li>
<li><span>Do the root-servers use NSEC or NSEC3? What about the .org domain?</span></li>
<li><span>How to take advantage of zone traversal as an attacker, how does it work?</span></li>
</ul>
</div><hr><blockquote>
<p><span>What are the main differences between NSEC and NSEC3?</span></p>
<blockquote>
<p><span>When a name server receives a request for a domain name that does not exist in a zone, the name server sends an authenticated negative response in the form of an NSEC or NSEC3 RR. NSEC and NSEC3 records contain the next secure domain name in a zone and list the RR types present at the NSEC or NSEC3 RR’s owner name. The difference between an NSEC and NSEC3 RRs is that the owner name in an NSEC3 RR is a cryptographic hash of the original owner name prepended to the name of the zone.</span></p>
</blockquote>
</blockquote><hr><blockquote>
<p><span>How to select one or the other during zone-signing?</span></p>
<blockquote>
<p><span>rndc signing -nsec3param will insert an NSEC3PARAM record into the zone and immediately sign it (if active keys are available and loaded) and generate NSEC3 records for the zone.</span><br>
<span>NSEC is the default.</span></p>
</blockquote>
</blockquote><blockquote>
<p><span>Do the root-servers use NSEC or NSEC3? What about the .org domain?</span></p>
<blockquote>
<p><span>root uses NSEC. org. uses NSEC3.</span></p>
</blockquote>
</blockquote><blockquote>
<p><span>How to take advantage of zone traversal as an attacker, how does it work?</span></p>
<blockquote>
<p><span>The NSEC record returns the previous and next name in the zone, which proves to the recursor that the queried name cannot possibly exist because nothing exists between the two names listed in the NSEC record. So, we can reconstruct the entire zone. By being able to query for all records from the DNS server, the attacker can easily determine which machines are accessible. The zone transfer may reveal network elements that are accessible from the Internet.</span></p>
</blockquote>
</blockquote><hr><h2 id="References" data-id="References"><a class="anchor hidden-xs" href="#References" title="References"><span class="octicon octicon-link"></span></a><span>References</span></h2><ol>
<li><a href="https://medium.com/iocscan/dns-cache-poisoning-bea939b5afaf" target="_blank" rel="noopener"><span>DNS Cache Poisoning</span></a></li>
<li><a href="https://www.networkworld.com/article/2277316/tech-primers-how-dns-cache-poisoning-works.html" target="_blank" rel="noopener"><span>How DNS cache poisoning works</span></a></li>
<li><a href="https://arstechnica.com/information-technology/2020/11/researchers-find-way-to-revive-kaminskys-2008-dns-cache-poisoning-attack/" target="_blank" rel="noopener"><span>DNS Cache Poisoning - Exploiting open ports</span></a></li>
<li><a href="https://www.digitalocean.com/community/tutorials/how-to-setup-dnssec-on-an-authoritative-bind-dns-server-2" target="_blank" rel="noopener"><span>How To Setup DNSSEC on BIND</span></a></li>
<li><a href="https://www.cyberciti.biz/faq/unix-linux-test-and-validate-dnssec-using-dig-command-line/" target="_blank" rel="noopener"><span>How to test and validate DNSSEC using dig command line</span></a></li>
<li><a href="https://datatracker.ietf.org/doc/html/rfc4641" target="_blank" rel="noopener"><span>RFC 4641 - DNSSEC Operational Practices</span></a></li>
<li><a href="https://dnsinstitute.com/documentation/dnssec-guide/ch03s04.html" target="_blank" rel="noopener"><span>DNSSEC Validation</span></a></li>
<li><a href="https://tools.ietf.org/id/draft-ietf-dnsop-algorithm-update-01.html#rfc.section.3" target="_blank" rel="noopener"><span>Algorithm Implementation Requirements and Usage Guidance for DNSSEC</span></a></li>
<li><a href="https://www.cloudflare.com/dns/dnssec/how-dnssec-works/" target="_blank" rel="noopener"><span>How DNSSEC Works</span></a></li>
<li><a href="http://book.itep.ru/4/4/dnssec.htm" target="_blank" rel="noopener"><span>DNSSEC</span></a></li>
<li><a href="https://www.isc.org/blogs/doh-talkdns/" target="_blank" rel="noopener"><span>DNS Over HTTPS With BIND 9.17</span></a></li>
<li><a href="https://datatracker.ietf.org/doc/html/rfc4034" target="_blank" rel="noopener"><span>Resource Records for the DNS Security Extensions</span></a></li>
<li><a href="https://adguard.com/en/blog/bye_dnscrypt.html" target="_blank" rel="noopener"><span>DNSCrypt</span></a></li>
</ol></div>
    <div class="ui-toc dropup unselectable hidden-print" style="display:none;">
        <div class="pull-right dropdown">
            <a id="tocLabel" class="ui-toc-label btn btn-default" data-toggle="dropdown" href="#" role="button" aria-haspopup="true" aria-expanded="false" title="Table of content">
                <i class="fa fa-bars"></i>
            </a>
            <ul id="ui-toc" class="ui-toc-dropdown dropdown-menu" aria-labelledby="tocLabel">
                <div class="toc"><ul class="nav">
<li><a href="#CIA-Lab-4---DNSSec-and-DoH" title="CIA Lab 4 - DNSSec and DoH">CIA Lab 4 - DNSSec and DoH</a><ul class="nav">
<li><a href="#Answers" title="Answers">Answers</a></li>
<li><a href="#Task-2---Validation-Resolver" title="Task 2 - Validation Resolver">Task 2 - Validation Resolver</a></li>
<li><a href="#Task-3---Secure-Zone" title="Task 3 - Secure Zone">Task 3 - Secure Zone</a></li>
<li><a href="#Task-4---Key-Rollovers" title="Task 4 - Key Rollovers">Task 4 - Key Rollovers</a></li>
<li><a href="#Task-5---DNS-over-HTTPS" title="Task 5 - DNS-over-HTTPS">Task 5 - DNS-over-HTTPS</a></li>
<li><a href="#Task-6---Secure-Zone-Delegation-2-points" title="Task 6 - Secure Zone Delegation (2 points)">Task 6 - Secure Zone Delegation (2 points)</a></li>
<li><a href="#Task-7---NSEC-vs-NSEC3" title="Task 7 - NSEC vs NSEC3">Task 7 - NSEC vs NSEC3</a></li>
<li><a href="#References" title="References">References</a></li>
</ul>
</li>
</ul>
</div><div class="toc-menu"><a class="expand-toggle" href="#">Expand all</a><a class="back-to-top" href="#">Back to top</a><a class="go-to-bottom" href="#">Go to bottom</a></div>
            </ul>
        </div>
    </div>
    <div id="ui-toc-affix" class="ui-affix-toc ui-toc-dropdown unselectable hidden-print" data-spy="affix" style="top:17px;display:none;" null null>
        <div class="toc"><ul class="nav">
<li><a href="#CIA-Lab-4---DNSSec-and-DoH" title="CIA Lab 4 - DNSSec and DoH">CIA Lab 4 - DNSSec and DoH</a><ul class="nav">
<li><a href="#Answers" title="Answers">Answers</a></li>
<li><a href="#Task-2---Validation-Resolver" title="Task 2 - Validation Resolver">Task 2 - Validation Resolver</a></li>
<li><a href="#Task-3---Secure-Zone" title="Task 3 - Secure Zone">Task 3 - Secure Zone</a></li>
<li><a href="#Task-4---Key-Rollovers" title="Task 4 - Key Rollovers">Task 4 - Key Rollovers</a></li>
<li><a href="#Task-5---DNS-over-HTTPS" title="Task 5 - DNS-over-HTTPS">Task 5 - DNS-over-HTTPS</a></li>
<li><a href="#Task-6---Secure-Zone-Delegation-2-points" title="Task 6 - Secure Zone Delegation (2 points)">Task 6 - Secure Zone Delegation (2 points)</a></li>
<li><a href="#Task-7---NSEC-vs-NSEC3" title="Task 7 - NSEC vs NSEC3">Task 7 - NSEC vs NSEC3</a></li>
<li><a href="#References" title="References">References</a></li>
</ul>
</li>
</ul>
</div><div class="toc-menu"><a class="expand-toggle" href="#">Expand all</a><a class="back-to-top" href="#">Back to top</a><a class="go-to-bottom" href="#">Go to bottom</a></div>
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.min.js" integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gist-embed/2.6.0/gist-embed.min.js" integrity="sha256-KyF2D6xPIJUW5sUDSs93vWyZm+1RzIpKCexxElmxl8g=" crossorigin="anonymous" defer></script>
    <script>
        var markdown = $(".markdown-body");
        //smooth all hash trigger scrolling
        function smoothHashScroll() {
            var hashElements = $("a[href^='#']").toArray();
            for (var i = 0; i < hashElements.length; i++) {
                var element = hashElements[i];
                var $element = $(element);
                var hash = element.hash;
                if (hash) {
                    $element.on('click', function (e) {
                        // store hash
                        var hash = this.hash;
                        if ($(hash).length <= 0) return;
                        // prevent default anchor click behavior
                        e.preventDefault();
                        // animate
                        $('body, html').stop(true, true).animate({
                            scrollTop: $(hash).offset().top
                        }, 100, "linear", function () {
                            // when done, add hash to url
                            // (default click behaviour)
                            window.location.hash = hash;
                        });
                    });
                }
            }
        }

        smoothHashScroll();
        var toc = $('.ui-toc');
        var tocAffix = $('.ui-affix-toc');
        var tocDropdown = $('.ui-toc-dropdown');
        //toc
        tocDropdown.click(function (e) {
            e.stopPropagation();
        });

        var enoughForAffixToc = true;

        function generateScrollspy() {
            $(document.body).scrollspy({
                target: ''
            });
            $(document.body).scrollspy('refresh');
            if (enoughForAffixToc) {
                toc.hide();
                tocAffix.show();
            } else {
                tocAffix.hide();
                toc.show();
            }
            $(document.body).scroll();
        }

        function windowResize() {
            //toc right
            var paddingRight = parseFloat(markdown.css('padding-right'));
            var right = ($(window).width() - (markdown.offset().left + markdown.outerWidth() - paddingRight));
            toc.css('right', right + 'px');
            //affix toc left
            var newbool;
            var rightMargin = (markdown.parent().outerWidth() - markdown.outerWidth()) / 2;
            //for ipad or wider device
            if (rightMargin >= 133) {
                newbool = true;
                var affixLeftMargin = (tocAffix.outerWidth() - tocAffix.width()) / 2;
                var left = markdown.offset().left + markdown.outerWidth() - affixLeftMargin;
                tocAffix.css('left', left + 'px');
            } else {
                newbool = false;
            }
            if (newbool != enoughForAffixToc) {
                enoughForAffixToc = newbool;
                generateScrollspy();
            }
        }
        $(window).resize(function () {
            windowResize();
        });
        $(document).ready(function () {
            windowResize();
            generateScrollspy();
        });

        //remove hash
        function removeHash() {
            window.location.hash = '';
        }

        var backtotop = $('.back-to-top');
        var gotobottom = $('.go-to-bottom');

        backtotop.click(function (e) {
            e.preventDefault();
            e.stopPropagation();
            if (scrollToTop)
                scrollToTop();
            removeHash();
        });
        gotobottom.click(function (e) {
            e.preventDefault();
            e.stopPropagation();
            if (scrollToBottom)
                scrollToBottom();
            removeHash();
        });

        var toggle = $('.expand-toggle');
        var tocExpand = false;

        checkExpandToggle();
        toggle.click(function (e) {
            e.preventDefault();
            e.stopPropagation();
            tocExpand = !tocExpand;
            checkExpandToggle();
        })

        function checkExpandToggle () {
            var toc = $('.ui-toc-dropdown .toc');
            var toggle = $('.expand-toggle');
            if (!tocExpand) {
                toc.removeClass('expand');
                toggle.text('Expand all');
            } else {
                toc.addClass('expand');
                toggle.text('Collapse all');
            }
        }

        function scrollToTop() {
            $('body, html').stop(true, true).animate({
                scrollTop: 0
            }, 100, "linear");
        }

        function scrollToBottom() {
            $('body, html').stop(true, true).animate({
                scrollTop: $(document.body)[0].scrollHeight
            }, 100, "linear");
        }
    </script>
</body>

</html>
